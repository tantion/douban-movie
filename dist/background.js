function refererHandle(a){"use strict";for(var b=0,c=a.requestHeaders.length;c>b;b+=1)if("Referer"===a.requestHeaders[b].name){a.requestHeaders[b].value=a.url;break}return{requestHeaders:a.requestHeaders}}chrome.webRequest.onHeadersReceived.addListener(function(a){"use strict";var b=!1,c=a.url.match(/\/([^\/]+$)/),d="";if(c&&window.gbk){c=c[1];try{c=window.gbk.decode(c)}catch(e){}}c=c||"filename.rar",d='attachment; filename="'+c+'"';for(var f=0,g=a.responseHeaders.length;g>f;f+=1)"Content-Disposition"===a.responseHeaders[f].name&&(a.responseHeaders[f].value=d,b=!0);return b||a.responseHeaders.push({name:"Content-Disposition",value:d}),{responseHeaders:a.responseHeaders}},{urls:["http://www.bitfish8.com/uploads/soft/*"]},["blocking","responseHeaders"]),chrome.webRequest.onBeforeSendHeaders.addListener(function(a){"use strict";for(var b=0,c=a.requestHeaders.length;c>b;b+=1)if("Referer"===a.requestHeaders[b].name){a.requestHeaders[b].value="http://www.bttiantang.com/download.php";break}return{requestHeaders:a.requestHeaders}},{urls:["http://192.184.95.23/?infohash=*"]},["blocking","requestHeaders"]),chrome.webRequest.onBeforeSendHeaders.addListener(function(a){"use strict";for(var b=0,c=a.requestHeaders.length;c>b;b+=1)if("Referer"===a.requestHeaders[b].name){a.requestHeaders[b].value=a.url;break}return{requestHeaders:a.requestHeaders}},{urls:["http://*/*/down.php","http://i.vod.xunlei.com/*","http://www.bitfish8.com/uploads/soft/*"]},["blocking","requestHeaders"]);var urls=[];chrome.runtime.onMessage.addListener(function(a,b,c){"use strict";var d;if(b&&b.tab&&(d=b.tab.index+1),"cookie"===a.action){var e=a.data.name;return chrome.cookies.get({url:"http://vod.xunlei.com",name:e},function(a){var b=a?a.value:"";c(b)}),!0}if("referer"===a.action){var f=a.data.url;-1===urls.indexOf(f)&&(urls.push(f),chrome.webRequest.onBeforeSendHeaders.removeListener(refererHandle),chrome.webRequest.onBeforeSendHeaders.addListener(refererHandle,{urls:urls},["blocking","requestHeaders"]))}else if("openurl"===a.action){var g=a.data.url;g&&chrome.tabs.create({url:g,index:d})}});