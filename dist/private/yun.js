define("private/yun",function(require,a,b){"use strict";function c(a){return/^\w+$/i.test(a)?!0:!1}function d(){var a=n.Deferred();return p?a.resolve():n.ajax({url:"http://i.vod.xunlei.com/req_history_play_list/req_num/30/req_offset/0?type=kongjian&order=create&folder_id=0",type:"get",dataType:"json",timeout:3e4}).done(function(b){b.resp.error_msg?a.reject('云播需要 <a href="http://vod.xunlei.com" class="private-yunbo-login" target="_blank">登录迅雷会员</a>'):(p=!0,a.resolve())}).fail(function(){a.reject("网络错误")}),a.promise()}function e(a){var b=new FormData,c=n.Deferred(),d=new XMLHttpRequest;return b.append("Filename","null.torrent"),b.append("Filedata",a,"null.torrent"),b.append("Upload","Submit Query"),d.open("POST","http://i.vod.xunlei.com/submit/post_bt",!0),d.responseType="json",d.onload=function(){var a=d.response;a.infohash?c.resolve(a.infohash):c.reject("bt地址无效")},d.onerror=function(){c.reject("网络错误")},d.timeout=6e4,d.ontimeout=function(){c.reject("上传bt超时")},d.send(b),c.promise()}function f(a){var b=n.Deferred(),c=null;return o.hasOwnProperty(a)?b.resolve(o[a]):d().done(function(){r.isPrivateBtUrl(a)||q.isTiangtangUrl(a)?(c=r.isPrivateBtUrl(a)?r.load(a):q.load(a),c.done(function(c){e(c).done(function(c){o[a]=c,b.resolve(c)}).fail(function(a){b.reject(a)})}).fail(function(a){b.reject(a)})):b.resolve(a)}).fail(function(a){b.reject(a)}),b.promise()}function g(a){var b=n.Deferred();return n.ajax({url:"http://i.vod.xunlei.com/req_subBT/info_hash/"+a+"/req_num/10/req_offset/0",type:"get",timeout:3e4,dataType:"json"}).done(function(a){var c=a.resp&&a.resp.subfile_list;c&&c.length?b.resolve(c):b.reject("没有找到播放列表")}).fail(function(){b.reject("网络错误")}),b.promise()}function h(a){var b=n.Deferred();return s.hasOwnProperty(a)?b.resolve(s[a]):g(a).done(function(c){var d="bt://"+a+"/"+c[0].index;s[a]=d,b.resolve(d)}).fail(function(a){b.reject(a)}),b.promise()}function i(a){var b=n.Deferred();return chrome.runtime.sendMessage({action:"cookie",data:{name:a}},function(a){b.resolve(a)}),b.promise()}function j(a){var b=n.Deferred();return n.when(i("sessionid"),i("userid")).done(function(d,e){if(d&&e){var f;c(a)?h(a).done(function(a){f="http://i.vod.xunlei.com/req_get_method_vod?url="+encodeURIComponent(a)+"&platform=1&userid="+e+"&vip=1&sessionid="+d,b.resolve(f)}).fail(function(a){b.reject(a)}):(f="http://i.vod.xunlei.com/req_get_method_vod?url="+encodeURIComponent(a)+"&platform=1&userid="+e+"&vip=1&sessionid="+d,b.resolve(f))}else b.reject("需要先登录迅雷")}).fail(function(){b.reject("网络错误")}),b.promise()}function k(a){var b=n.Deferred();return n.ajax({url:a,type:"get",dataType:"json",timeout:3e4}).done(function(a){var c=a&&a.resp?a.resp.vodinfo_list:[];c&&c.length?b.resolve(c):b.reject("转码未完成，无法播放")}).fail(function(){b.reject("网络错误")}),b.promise()}function l(a){var b=n.Deferred();return d().done(function(){j(a).done(function(a){k(a).done(function(a){b.resolve(a)}).fail(function(a){b.reject(a)})}).fail(function(a){b.reject(a)})}).fail(function(a){b.reject(a)}),b.promise()}function m(a){var b=n.Deferred();return f(a).done(function(a){n.when(i("userid"),i("sessionid")).done(function(d,e){var f={};f.urls=c(a)?[{id:1,url:"bt://"+a}]:[{id:0,url:a}],d&&e?n.ajax({url:"http://i.vod.xunlei.com/req_add_record?from=vlist&platform=0&userid="+d+"&sessionid="+e+"&folder_id=0",type:"post",processData:!1,data:JSON.stringify(f),dataType:"json"}).done(function(a){a&&a.resp&&a.resp.res&&a.resp.res.length?b.resolve():b.reject("添加失败，可能是地址错误")}).fail(function(){b.reject("网络错误")}):b.reject('云播需要 <a href="http://vod.xunlei.com" class="private-yunbo-login" target="_blank">登录迅雷会员</a>')}).fail(function(){b.reject("网络错误")})}).fail(function(a){b.reject(a)}),b.promise()}var n=require("jquery"),o={},p=!1,q=require("js/bt-tiantang"),r=require("private/bt"),s={};b.exports={requestHash:f,requestBtUrl:h,requestUrlByHash:l,hasLogin:d,addByUrl:m,cookie:i}});