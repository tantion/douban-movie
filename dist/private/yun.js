define("private/yun",function(require,a,b){"use strict";function c(){var a=k.Deferred();return m?a.resolve():k.ajax({url:"http://i.vod.xunlei.com/req_history_play_list/req_num/30/req_offset/0?type=kongjian&order=create&folder_id=0",type:"get",dataType:"json",timeout:3e4}).done(function(b){b.resp.error_msg?a.reject('云播需要<a href="http://vod.xunlei.com" target="_blank">登录迅雷会员</a>'):(m=!0,a.resolve())}).fail(function(){a.reject("网络错误")}),a.promise()}function d(a){var b=new FormData,c=k.Deferred(),d=new XMLHttpRequest;return b.append("Filename","null.torrent"),b.append("Filedata",a,"null.torrent"),b.append("Upload","Submit Query"),d.open("POST","http://i.vod.xunlei.com/submit/post_bt",!0),d.responseType="json",d.onload=function(){var a=d.response;a.infohash?c.resolve(a.infohash):c.reject("上传bt失败，或者bt无效")},d.onerror=function(){c.reject("网络错误")},d.send(b),c.promise()}function e(){var a=k.Defer();return a.promise()}function f(a){var b=k.Deferred(),f=null;return l.hasOwnProperty(a)?b.resovle(l[a]):c().done(function(){o.isPrivateBtUrl(a)||n.isTiangtangUrl(a)?(f=o.isPrivateBtUrl(a)?o.load(a):n.load(a),f.done(function(c){d(c).done(function(c){l[a]=c,b.resolve(c)}).fail(function(a){b.reject(a)})}).fail(function(a){b.reject(a)})):e(a).done(function(c){l[a]=c,b.resolve(c)}).fail(function(a){b.reject(a)})}).fail(function(a){b.reject(a)}),b.promise()}function g(a){var b=k.Deferred();return chrome.runtime.sendMessage({action:"cookie",data:{name:a}},function(a){b.resolve(a)}),b.promise()}function h(a){var b=k.Deferred();return k.when(g("sessionid"),g("userid")).done(function(c,d){if(c&&d){var e="http://i.vod.xunlei.com/req_get_method_vod?url=bt%3A%2F%2F"+a+"%2F0&platform=1&userid="+d+"&vip=1&sessionid="+c;b.resolve(e)}else b.reject("需要先登录迅雷")}).fail(function(){b.reject("网络错误")}),b.promise()}function i(a){var b=k.Deferred();return k.ajax({url:a,type:"get",dataType:"json",timeout:3e4}).done(function(a){var c=a&&a.resp?a.resp.vodinfo_list:[];c&&c.length?b.resolve(c):b.reject("转码未完成，无法播放")}).fail(function(){b.reject("网络错误")}),b.promise()}function j(a){var b=k.Deferred();return h(a).done(function(a){i(a).done(function(a){b.resolve(a)}).fail(function(a){b.reject(a)})}).fail(function(a){b.reject(a)}),b.promise()}var k=require("jquery"),l={},m=!1,n=require("js/bt-tiantang"),o=require("private/bt");b.exports={requestHash:f,requestUrlByHash:j,hasLogin:c,cookie:g}});