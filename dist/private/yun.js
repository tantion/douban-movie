define("private/yun",function(require,a,b){"use strict";function c(a){var b=d.Deferred(),c=new XMLHttpRequest,e=a.match(/^(http:\/\/\w+\.kidown\.com\/\w+\/)file\.php\/(\w+)\.html/i);if(e&&e.length){c.open("POST",e[1]+"down.php",!0),c.responseType="arraybuffer",c.onload=function(){var a=new Blob([c.response],{type:"application/octet-stream"});b.resolve(a)},c.onerror=function(){b.reject()};var f=new FormData;f.append("type","torrent"),f.append("name","null"),f.append("id",e[2]),c.send(f)}else c.open("GET",a,!0),c.responseType="arraybuffer",c.onload=function(){var a=new Blob([c.response],{type:"application/octet-stream"});b.resolve(a)},c.onerror=function(){b.reject()},c.send();return b.promise()}var d=require("jquery"),e=document.createElement("a"),f=require("purl");b.exports={requestHash:function(){var a=d.Deferred(),b=f(location.href).param(),c=b.url||"",e=b.infohash||"";return e?a.resolve(e):this.upload(c).done(function(b){history.replaceState(null,null,location.pathname+"?infohash="+b),a.resolve(b)}).fail(function(){a.reject()}),a.promise()},upload:function(a){var b=d.Deferred();return c(a).done(function(a){var c=new FormData,d=new XMLHttpRequest;c.append("Filename","null.torrent"),c.append("Filedata",a,"null.torrent"),c.append("Upload","Submit Query"),d.open("POST","http://i.vod.xunlei.com/submit/post_bt",!0),d.responseType="json",d.onload=function(){var a=d.response;a.infohash?b.resolve(a.infohash):b.reject()},d.onerror=function(){b.reject()},d.send(c)}).fail(function(){b.reject()}),b.promise()},requestList:function(a){var b=d.Deferred();return d.ajax({url:"http://i.vod.xunlei.com/req_subBT/info_hash/"+a+"/req_num/10/req_offset/0",type:"get",timeout:3e4,dataType:"json"}).done(function(a){var c=a.subfile_list;c&&c.length?b.resolve(c):b.reject()}).fail(function(){b.reject()}),b.promise()},requestUrl:function(a){var b=d.Deferred();return d.ajax({url:a,type:"get",dataType:"json",timeout:3e4}).done(function(a){var c=a&&a.resp?a.resp.vodinfo_list:[],d="";c?(c.length&&(e.setAttribute("href",c[0].vod_url),d="http://"+e.host+"/*",chrome.runtime.sendMessage({action:"referer",data:{url:d}})),b.resolve(c)):b.reject()}).fail(function(){b.reject()}),b.promise()},requestUrl2:function(){var a=d.Deferred(),b=this;return this.requestHash().pipe(function(a){return b.requestVod(a)}).pipe(function(a){return b.requestUrl(a)}).done(function(b){a.resolve(b)}).fail(function(){a.reject()}),a.promise()},hasLogin:function(){var a=d.Deferred();return d.ajax({url:"http://i.vod.xunlei.com/req_history_play_list/req_num/30/req_offset/0?type=kongjian&order=create&folder_id=0",type:"get",dataType:"json",timeout:3e4}).done(function(b){b.resp.error_msg?a.reject():a.resolve()}).fail(function(){a.reject()}),a.promise()},requestVod:function(a){var b=d.Deferred();return d.when(this.cookie("sessionid"),this.cookie("userid")).done(function(c,d){if(c&&d){var e="http://i.vod.xunlei.com/req_get_method_vod?url=bt%3A%2F%2F"+a+"%2F0&platform=1&userid="+d+"&vip=1&sessionid="+c;b.resolve(e)}else b.reject()}).fail(function(){b.reject()}),b.promise()},cookie:function(a){var b=d.Deferred();return chrome.runtime.sendMessage({action:"cookie",data:{name:a}},function(a){b.resolve(a)}),b.promise()}}});