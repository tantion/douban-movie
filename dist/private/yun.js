define("private/yun",function(require,a,b){"use strict";function c(a){var b=d.Deferred(),c=new XMLHttpRequest,e=a.match(/^(http:\/\/\w+\.kidown\.com\/\w+\/)file\.php\/(\w+)\.html/i);if(e&&e.length){c.open("POST",e[1]+"down.php",!0),c.responseType="arraybuffer",c.onload=function(){var a=new Blob([c.response],{type:"application/octet-stream"});b.resolve(a)},c.onerror=function(){b.reject()};var f=new FormData;f.append("type","torrent"),f.append("name","null"),f.append("id",e[2]),c.send(f)}else c.open("GET",a,!0),c.responseType="arraybuffer",c.onload=function(){var a=new Blob([c.response],{type:"application/octet-stream"});b.resolve(a)},c.onerror=function(){b.reject()},c.send();return b.promise()}var d=require("jquery"),e=require("purl");b.exports={requestHash:function(){var a=d.Deferred(),b=e(location.href).param(),c=b.url||"",f=b.infohash||"";return f?a.resolve(f):this.upload(c).done(function(b){history.replaceState(null,null,location.pathname+"?infohash="+b),a.resolve(b)}).fail(function(){a.reject()}),a.promise()},upload:function(a){var b=d.Deferred();return c(a).done(function(a){var c=new FormData,d=new XMLHttpRequest;c.append("Filename","null.torrent"),c.append("Filedata",a,"null.torrent"),c.append("Upload","Submit Query"),d.open("POST","http://i.vod.xunlei.com/submit/post_bt",!0),d.responseType="json",d.onload=function(){var a=d.response;a.infohash?b.resolve(a.infohash):b.reject()},d.onerror=function(){b.reject()},d.send(c)}).fail(function(){b.reject()}),b.promise()},requestList:function(a){var b=d.Deferred();return d.ajax({url:"http://i.vod.xunlei.com/req_subBT/info_hash/"+a+"/req_num/10/req_offset/0",type:"get",timeout:3e4,dataType:"json"}).done(function(a){var c=a.subfile_list;c&&c.length?b.resolve(c):b.reject()}).fail(function(){b.reject()}),b.promise()},requestUrl:function(a){var b=d.Deferred();return this.requestList(a).done(function(a){a[0]}).fail(function(){b.reject()}),b.promise()},hasLogin:function(){var a=d.Deferred();return d.ajax({url:"http://i.vod.xunlei.com/req_history_play_list/req_num/30/req_offset/0?type=kongjian&order=create&folder_id=0",type:"get",dataType:"json",timeout:3e4}).done(function(b){b.resp.error_msg?a.reject():a.resolve()}).fail(function(){a.reject()}),a.promise()},cookie:function(a){var b=d.Deferred();return chrome.runtime.sendMessage({action:"cookie",data:{name:a}},function(a){b.resolve(a)}),b.promise()}}});