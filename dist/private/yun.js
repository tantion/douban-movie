define("private/yun",function(require,a,b){"use strict";function c(a){return/^\w+$/i.test(a)?!0:!1}function d(){var a=l.Deferred();return n?a.resolve():l.ajax({url:"http://i.vod.xunlei.com/req_history_play_list/req_num/30/req_offset/0?type=kongjian&order=create&folder_id=0",type:"get",dataType:"json",timeout:3e4}).done(function(b){b.resp.error_msg?a.reject('云播需要 <a href="http://vod.xunlei.com" class="private-yunbo-login" target="_blank">登录迅雷会员</a>'):(n=!0,a.resolve())}).fail(function(){a.reject("网络错误")}),a.promise()}function e(a){var b=new FormData,c=l.Deferred(),d=new XMLHttpRequest;return b.append("Filename","null.torrent"),b.append("Filedata",a,"null.torrent"),b.append("Upload","Submit Query"),d.open("POST","http://i.vod.xunlei.com/submit/post_bt",!0),d.responseType="json",d.onload=function(){var a=d.response;a.infohash?c.resolve(a.infohash):c.reject("上传bt失败，或者bt无效")},d.onerror=function(){c.reject("网络错误")},d.send(b),c.promise()}function f(a){var b=l.Deferred(),c=null;return m.hasOwnProperty(a)?b.resolve(m[a]):d().done(function(){p.isPrivateBtUrl(a)||o.isTiangtangUrl(a)?(c=p.isPrivateBtUrl(a)?p.load(a):o.load(a),c.done(function(c){e(c).done(function(c){m[a]=c,b.resolve(c)}).fail(function(a){b.reject(a)})}).fail(function(a){b.reject(a)})):b.resolve(a)}).fail(function(a){b.reject(a)}),b.promise()}function g(a){var b=l.Deferred();return chrome.runtime.sendMessage({action:"cookie",data:{name:a}},function(a){b.resolve(a)}),b.promise()}function h(a){var b=l.Deferred();return l.when(g("sessionid"),g("userid")).done(function(d,e){if(d&&e){var f;f=c(a)?"http://i.vod.xunlei.com/req_get_method_vod?url=bt%3A%2F%2F"+a+"%2F0&platform=1&userid="+e+"&vip=1&sessionid="+d:"http://i.vod.xunlei.com/req_get_method_vod?url="+encodeURIComponent(a)+"&platform=1&userid="+e+"&vip=1&sessionid="+d,b.resolve(f)}else b.reject("需要先登录迅雷")}).fail(function(){b.reject("网络错误")}),b.promise()}function i(a){var b=l.Deferred();return l.ajax({url:a,type:"get",dataType:"json",timeout:3e4}).done(function(a){var c=a&&a.resp?a.resp.vodinfo_list:[];c&&c.length?b.resolve(c):b.reject("转码未完成，无法播放")}).fail(function(){b.reject("网络错误")}),b.promise()}function j(a){var b=l.Deferred();return d().done(function(){h(a).done(function(a){i(a).done(function(a){b.resolve(a)}).fail(function(a){b.reject(a)})}).fail(function(a){b.reject(a)})}).fail(function(a){b.reject(a)}),b.promise()}function k(a){var b=l.Deferred();return f(a).done(function(a){l.when(g("userid"),g("sessionid")).done(function(d,e){var f={};f.urls=c(a)?[{id:1,url:"bt://"+a}]:[{id:0,url:a}],d&&e?l.ajax({url:"http://i.vod.xunlei.com/req_add_record?from=vlist&platform=0&userid="+d+"&sessionid="+e+"&folder_id=0",type:"post",processData:!1,data:JSON.stringify(f),dataType:"json"}).done(function(a){a&&a.resp&&a.resp.res&&a.resp.res.length?b.resolve():b.reject("添加失败，可能是地址错误")}).fail(function(){b.reject("网络错误")}):b.reject('云播需要 <a href="http://vod.xunlei.com" class="private-yunbo-login" target="_blank">登录迅雷会员</a>')}).fail(function(){b.reject("网络错误")})}).fail(function(a){b.reject(a)}),b.promise()}var l=require("jquery"),m={},n=!1,o=require("js/bt-tiantang"),p=require("private/bt");b.exports={requestHash:f,requestUrlByHash:j,hasLogin:d,addByUrl:k,cookie:g}});