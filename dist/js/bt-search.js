define(function(require,a,b){"use strict";function c(){var a={},b=f("#content"),c=f("#info"),d=f.trim(f("#content .related-info h2").text());return a.title2=d.replace(/^(.+)的剧情简介.*$/,"$1"),a.title=f.trim(b.find('[property="v:itemreviewed"]').text()),a.imdb=f.trim(c.find('a[href^="http://www.imdb.com/title/tt"]').text()),a}function d(){var a='<div class="movie-improve-bt-container"><div class="movie-improve-nav-container">{{#tabs}}{{#index}}&nbsp;|&nbsp;{{/index}}<a class="movie-improve-nav" data-index="{{index}}" href="#movie-improve-tab-{{index}}">{{name}}</a>{{/tabs}}</div><div class="movie-improve-tab-container">{{#tabs}}<div class="movie-improve-tab" id="movie-improve-tab-{{index}}"></div>{{/tabs}}</div></div>',b=c(),d=null,e=null;return d=f.map(i,function(a,b){return{name:a.name||"未名",index:b}}),e=f(h.render(a,{tabs:d})),e.on("click",".movie-improve-nav",function(a){a.preventDefault();var c=f(this),d=c.data("index"),g=e.find(c.attr("href")),h=i[d];c.siblings().removeClass("active"),c.addClass("active"),g.siblings().removeClass("active"),g.addClass("active"),h.search(b).progress(function(a){g.html(a)}).done(function(a){g.html(a)}).fail(function(){g.html("没有搜到相关的bt种子，切换一下其他搜索试试。")})}).find(".movie-improve-nav").first().click(),g.setTitle(b.title2+" BT地址列表"),e}function e(){location.href.match(/^http:\/\/movie\.douban\.com\/subject\/\d+/)&&Do.ready("dialog",function(){var a=f('<div><span class="pl">BT地址:</span> <a href="javascript:">打开列表</a></div>').appendTo("#info").find("a");a.on("click",function(a){a.preventDefault(),g||(g=dui.Dialog({width:700},!0)),g.setContent(d()),g.open()})})}var f=require("jquery"),g=null,h=require("mustache"),i=[require("js/bt-tiantang"),require("js/bt-mee"),require("js/bt-imax"),require("js/bt-baidu"),require("js/bt-shooter")];b.exports={init:e}});