define("js/bt-search",function(require,a,b){"use strict";function c(){var a={},b=i("#content"),c=i("#info"),d=i.trim(i("#content .related-info h2").text());return a.title2=d.replace(/^(.+)的剧情简介.*$/,"$1"),a.title=i.trim(b.find('[property="v:itemreviewed"]').text()),a.stars=parseFloat(b.find('[property="v:average"]').text()),a.actors=i.trim(c.find('[rel="v:starring"]').parent().text()),a.year=parseInt(i.trim(b.find(".year").text()).replace(/\((\d+)\)/,"$1"),10),a.imdb=i.trim(c.find('a[href^="http://www.imdb.com/title/tt"]').text()),a}function d(a,b,c){var d=b.data("index"),e=c.find(b.attr("href")),f=b.find("span"),g=m[d];g.search(a).progress(function(a){e.html(a),f.html("..")}).done(function(a,b){e.html(a),f.html(b||0)}).fail(function(){e.html("没有搜到相关的bt种子，切换一下其他搜索试试。"),f.html(0)})}function e(a,b){{var c=a.data("index"),d=b.find(a.attr("href"));m[c]}a.siblings().removeClass("active"),a.addClass("active"),d.siblings().removeClass("active"),d.addClass("active")}function f(){var a='<div class="movie-improve-bt-container"><div class="movie-improve-nav-container">{{#tabs}}{{#index}}&nbsp;|&nbsp;{{/index}}<a class="movie-improve-nav" data-index="{{index}}" href="#movie-improve-tab-{{index}}">{{name}} (<span>...</span>)</a>{{/tabs}}</div><div class="movie-improve-tab-container">{{#tabs}}<div class="movie-improve-tab" id="movie-improve-tab-{{index}}"></div>{{/tabs}}</div></div>',b=c(),f=null,g=null;return f=i.map(m,function(a,b){return{name:a.name||"未名",index:b}}),g=i(k.render(a,{tabs:f})),g.on("click",".movie-improve-nav",function(a){a.preventDefault();var c=i(this);e(c,g),d(b,c,g)}).find(".movie-improve-nav").each(function(a){var c=i(this);0===a&&e(c,g),d(b,c,g)}),j.setTitle(b.title2+" BT地址列表"),g}function g(a,b){var c=a.text()||"";c=c.replace(/\(.+\)/,"("+b+")"),a.text(c)}function h(){if(location.href.match(/^http:\/\/movie\.douban\.com\/subject\/\d+/)){var a=i('<div><span class="pl">BT地址:</span> <a href="javascript:" class="movie-improve-open-link">打开列表 (..)</a></div>').appendTo("#info").find("a");a.on("click",function(a){a.preventDefault(),j||(j=dui.Dialog({nodeId:"movie-improve-dialog",width:700},!0)),j.setContent(f()),j.open()});var b=c(),d=0;l.each(m,function(c,e){"射手字幕"!==c.name?c.search(b).done(function(b,c){d+=c,g(a,d)}).always(function(){e()}):e()},function(){g(a,d)})}}var i=require("jquery"),j=null,k=require("mustache"),l=require("async"),m=[require("js/bt-tiantang"),require("js/bt-imax"),require("js/bt-fangying"),require("js/bt-mee"),require("js/bt-baidu"),require("js/bt-shooter")];b.exports={init:h}});