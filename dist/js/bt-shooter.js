define(function(require,a,b){"use strict";function c(){}function d(a){var b=h.render(k,{items:a}),d=g(b);return d.on("mouseenter",".movie-improve-bt-download",function(){g(this).tipsy({gravity:"w",offset:3}).tipsy("show")}).on("click",".movie-improve-bt-download",function(a){a.preventDefault();var b=g(this);c(b.attr("href")).fail(function(){b.attr("title","没有找到下载地址。")})}),d}function e(a){var b=new g.Deferred,c="http://www.shooter.cn/search2/"+encodeURI(a),d=null;return j.hasOwnProperty(a)?(d=j[a],d&&d.length?b.resolve(d):b.reject()):g.ajax({url:c,type:"GET",timeout:i,xhrFields:{withCredentials:!0}}).done(function(c){c=c.replace(/src=/gi,"data-src=");var d=g(g.parseHTML(c)),e=d.find("#resultsdiv").eq(0).find(".introtitle"),f=[];f=g.map(e,function(b){var c=g(b),d=c.closest(".sublist_box_title").next().html()||"",e=c.parent().next().attr("title"),f=d.search("VobSub")?"srt":"",h=d.match(/语言： ([^<]+)<\//),i=d.match(/调校：([^<]+)<\//),j=g.trim(c.text());return f&&(d="["+f+"]"),h&&h[1]&&(d+="["+h[1]+"]"),e&&(d+="["+e+"]"),j=d+" "+j,i&&i[1]&&(d=g.trim(i[1]),d.match(/^[\w和]+$/)&&(d="")),j.search(a)>-1?{href:"http://shooter.cn"+c.attr("href"),title:j,desc:d}:null}),j[a]=f,f.length?b.resolve(f):b.reject()}).fail(function(){b.reject()}),b.promise()}function f(a){var b=new g.Deferred,c=""+a.title2;return c?(b.notify("正在加载字幕..."),e(c).done(function(a){b.resolve(d(a))}).fail(function(){b.reject()})):b.reject(),b.promise()}var g=require("jquery"),h=require("mustache"),i=3e4,j={},k='{{#items}}<dl class="movie-improve-bt-dl"><dt class="movie-improve-bt-title"><a title="点击下载字幕文件" class="movie-improve-bt-download" href="{{href}}">{{title}}</a></dt>{{#desc}}<dd class="movie-improve-bt-desc">{{&desc}}</dd>{{/desc}}</dl>{{/items}}';b.exports={name:"射手字幕",search:f}});